{
  "openapi": "3.0.0",
  "info": {
    "title": "Text2SQL Furniture Inventory API",
    "description": "A natural language to SQL API service that converts Thai/English questions into SQL queries and executes them against a furniture inventory database. Powered by IBM WatsonX.ai GPT-OSS-120B model for intelligent querying capabilities including product inventory management, category analysis, price and stock monitoring, assembly requirements tracking, and warranty information.",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "https://application-89-text2sql.22l9uxc25em9.us-south.codeengine.appdomain.cloud",
      "description": "Production server on IBM Code Engine"
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "summary": "Health Check",
        "description": "Check the health status of the API service and database connection",
        "operationId": "healthCheck",
        "tags": ["System"],
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    },
                    "db_connected": {
                      "type": "boolean",
                      "example": true
                    },
                    "db_path": {
                      "type": "string",
                      "example": "/app/furniture.db"
                    }
                  },
                  "required": ["status", "db_connected", "db_path"]
                }
              }
            }
          }
        }
      }
    },
    "/text2sql": {
      "post": {
        "summary": "convert_text_to_sql",
        "description": "Converts a natural language question (Thai or English) about furniture inventory into a SQL query, executes it against the database, and returns results with an AI-generated explanation. Supports product searches by category, material, color, price range, inventory analysis, stock status, assembly requirements, warranty information, and business analytics.",
        "operationId": "convert_text_to_sql",
        "tags": ["Text2SQL"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Text2SQLRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully generated SQL, executed query, and returned results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Text2SQLResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid input, SQL parsing error, or query execution error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error - Model or database connection issues",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Text2SQLRequest": {
        "type": "object",
        "properties": {
          "question": {
            "type": "string",
            "description": "Natural language question about furniture inventory (Thai or English)",
            "example": "สินค้าในหมวดห้องนั่งเล่นที่ราคาสูงกว่า 1000 บาท",
            "minLength": 1,
            "maxLength": 1000
          },
          "assumptions": {
            "type": "string",
            "description": "Optional clarifications or additional context for the query",
            "example": "Focus on premium products for quarterly sales report",
            "maxLength": 500,
            "nullable": true
          },
          "limit": {
            "type": "integer",
            "description": "Maximum number of rows to return",
            "minimum": 1,
            "maximum": 10000,
            "default": 200,
            "example": 100
          }
        },
        "required": ["question"]
      },
      "Text2SQLResponse": {
        "type": "object",
        "properties": {
          "sql_query": {
            "type": "string",
            "description": "Generated SQL query that was executed",
            "example": "SELECT หมวดหมู่, COUNT(*) as จำนวนสินค้า FROM สินค้า WHERE ราคา > 1000 GROUP BY หมวดหมู่;"
          },
          "explanation": {
            "type": "string",
            "description": "AI-generated explanation of the query results in business context",
            "example": "The query found 15 living room products priced above 1000 baht, representing premium furniture options. This accounts for 60% of the living room category, indicating a focus on higher-end inventory."
          },
          "results": {
            "type": "object",
            "properties": {
              "columns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Column names from the query result",
                "example": ["หมวดหมู่", "จำนวนสินค้า", "ราคาเฉลี่ย"]
              },
              "rows": {
                "type": "array",
                "items": {
                  "type": "object"
                },
                "description": "Query result rows as objects",
                "example": [
                  {"หมวดหมู่": "ห้องนั่งเล่น", "จำนวนสินค้า": 25, "ราคาเฉลี่ย": 1500.50},
                  {"หมวดหมู่": "ห้องนอน", "จำนวนสินค้า": 18, "ราคาเฉลี่ย": 2200.75}
                ]
              },
              "row_count": {
                "type": "integer",
                "description": "Total number of rows returned",
                "example": 5
              }
            },
            "required": ["columns", "rows", "row_count"]
          }
        },
        "required": ["sql_query", "explanation", "results"]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "detail": {
            "type": "string",
            "description": "Error message describing the issue",
            "example": "SQL parsing error: No valid SQL query found in model output"
          }
        },
        "required": ["detail"]
      },
      "ValidationError": {
        "type": "object",
        "properties": {
          "detail": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "loc": {
                  "type": "array",
                  "items": {
                    "anyOf": [
                      {"type": "string"},
                      {"type": "integer"}
                    ]
                  },
                  "description": "Location of the error"
                },
                "msg": {
                  "type": "string",
                  "description": "Error message"
                },
                "type": {
                  "type": "string",
                  "description": "Error type"
                }
              }
            }
          }
        }
      }
    }
  }
}